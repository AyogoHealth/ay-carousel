var AyCarousel = (function () {
    function AyCarousel(carousel) {
        var _this = this;
        this.startX = 0;
        this.startY = 0;
        this.callbacks = {};
        this.index = 0;
        this.SNAPPINESS = 40;
        if (carousel) {
            this.carousel = carousel;
            this.carousel.addEventListener('touchstart', function (e) { return _this.ondragstart(e); });
            this.carousel.addEventListener('mousedown', function (e) { return _this.ondragstart(e); });
            this.cards = this.carousel.children;
            this.cardWidth = this.cards[0].offsetWidth + this.cards[0].offsetLeft;
            this.carousel.addEventListener('transitionend', function () {
                _this.rescale();
            });
            this.rescale();
        }
    }
    AyCarousel.prototype.ondragstart = function (e) {
        var _this = this;
        var touches = e.touches ? e.touches[0] : e;
        var pageX = touches.pageX, pageY = touches.pageY;
        var boundingRect = this.cards[this.index].getBoundingClientRect();
        this.offset = {
            x: pageX - boundingRect.left,
            y: pageY - boundingRect.top
        };
        this.delta = {};
        this.position = {
            x: this.carousel.offsetLeft,
            y: this.carousel.offsetTop
        };
        var edgeToCardDist = this.cards[this.index].getBoundingClientRect().left;
        this.lastTranslate = this.carousel.getBoundingClientRect().left - edgeToCardDist;
        this.totalMove =
            this.startX = pageX;
        this.startY = pageY;
        this.dragging = undefined;
        this.callbacks.onmove = function (e) { return _this.ondragmove(e); };
        this.callbacks.onend = function (e) { return _this.ondragend(e); };
        this.totalMove = {
            x: 0,
            y: 0
        };
        this.lastPos = {
            x: 0,
            y: 0
        };
        this.carousel.addEventListener('mousemove', this.callbacks.onmove);
        this.carousel.addEventListener('touchmove', this.callbacks.onmove);
        this.carousel.addEventListener('touchend', this.callbacks.onend);
        this.carousel.addEventListener('mouseup', this.callbacks.onend);
        this.carousel.addEventListener('mouseleave', this.callbacks.onend);
    };
    AyCarousel.prototype.ondragmove = function (e) {
        var touches = e.touches ? e.touches[0] : e;
        var pageX = touches.pageX, pageY = touches.pageY;
        var move = {
            x: this.startX - pageX,
            y: this.startY - pageY
        };
        this.totalMove.x += Math.abs(move.x - this.lastPos.x);
        this.totalMove.y += Math.abs(move.y - this.lastPos.y);
        this.lastPos = {
            x: move.x,
            y: move.y
        };
        if (this.totalMove.x < 10 && this.totalMove.y < 10) {
            return;
        }
        if (this.totalMove.x > this.totalMove.y) {
            e.preventDefault();
            this.delta = {
                x: pageX - this.position.x,
                y: pageY - this.position.y
            };
            var currentTranslate = this.delta.x + this.lastTranslate - this.offset.x;
            this.translate(currentTranslate, 0, null);
            var cardMidpoint = (this.cards[this.index].getBoundingClientRect().left + this.cards[this.index].getBoundingClientRect().right) / 2;
            var viewportWidth = window.innerWidth;
            if (cardMidpoint <= 0 + this.SNAPPINESS) {
                this.index = Math.min(this.index + 1, this.cards.length - 1);
            }
            else if (cardMidpoint > viewportWidth - this.SNAPPINESS) {
                this.index = Math.max(this.index - 1, 0);
            }
        }
    };
    AyCarousel.prototype.snap = function (nextIndex, direction) {
        if (direction) {
            direction == 'right' ? nextIndex = this.index + 1 : nextIndex = this.index - 1;
        }
        nextIndex = Math.min(Math.max(nextIndex, 0), this.cards.length - 1);
        this.index = nextIndex;
        var container = this.carousel.parentElement;
        var containerWidth = container.offsetWidth;
        var containerMargin = parseInt(window.getComputedStyle(container).marginLeft, 0);
        var card = this.cards[nextIndex];
        var edgeToCardDist = (containerWidth - card.offsetWidth) / 2;
        var nextOffset = Math.min((card.offsetLeft - edgeToCardDist + containerMargin) * -1, 0);
        var ease = 'cubic-bezier(0.785, 0.135, 0.15, 0.86)';
        this.translate(nextOffset, 250, ease);
    };
    AyCarousel.prototype.ondragend = function (e) {
        this.position = {
            x: e.target.offsetLeft,
            y: e.target.offsetTop
        };
        this.totalMove = {
            x: 0,
            y: 0
        };
        this.carousel.removeEventListener('mousemove', this.callbacks.onmove);
        this.carousel.removeEventListener('touchmove', this.callbacks.onmove);
        this.carousel.removeEventListener('touchend', this.callbacks.onend);
        this.carousel.removeEventListener('mouseup', this.callbacks.onend);
        this.carousel.removeEventListener('mouseleave', this.callbacks.onend);
        this.dragging = undefined;
        this.snap(this.index, undefined);
        this.rescale();
    };
    AyCarousel.prototype.translate = function (x, length, fn) {
        this.carousel.style['transition'] = 'transform';
        this.carousel.style['transitionTimingFunction'] = fn;
        this.carousel.style['transitionDuration'] = length + "ms";
        this.carousel.style['transform'] = "translate3d(" + x + "px,0px,0px)";
        this.rescale();
    };
    AyCarousel.prototype.percentVisible = function (card) {
        var cardRect = card.getBoundingClientRect();
        var cardWidth = card.offsetWidth;
        var frameWidth = window.innerWidth;
        if ((cardRect.left < 0 && cardRect.right < 0) || cardRect.left > frameWidth) {
            return 0;
        }
        else if (cardRect.left < 0) {
            return cardRect.right / cardWidth;
        }
        else if (cardRect.right > frameWidth) {
            return (frameWidth - cardRect.left) / cardWidth;
        }
        else {
            return 1;
        }
    };
    AyCarousel.prototype.rescale = function () {
        var from = Math.max(this.index - 2, 0);
        var to = Math.min(this.index + 2, this.cards.length - 1);
        for (var i = from; i <= to; i++) {
            var scaler = Math.max(this.percentVisible(this.cards[i]), 0.9);
            this.cards[i].style['transform'] = "scale(" + scaler + ")";
            this.cards[i].style['transitionTimingFunction'] = 'ease';
            this.cards[i].style['transitionDuration'] = "250ms";
        }
    };
    return AyCarousel;
}());
new AyCarousel(document.querySelector('#carousel-1'));
new AyCarousel(document.querySelector('#carousel-2'));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7SUFrQkUsb0JBQVksUUFBc0I7UUFBbEMsaUJBZ0JDO1FBL0JELFdBQU0sR0FBWSxDQUFDLENBQUM7UUFDcEIsV0FBTSxHQUFZLENBQUMsQ0FBQztRQUtwQixjQUFTLEdBQVMsRUFBRSxDQUFDO1FBR3JCLFVBQUssR0FBWSxDQUFDLENBQUM7UUFFVixlQUFVLEdBQVksRUFBRSxDQUFDO1FBS2hDLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDWixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztZQUV6QixJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLFlBQVksRUFBRSxVQUFBLENBQUMsSUFBSSxPQUFBLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQW5CLENBQW1CLENBQUMsQ0FBQztZQUN2RSxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxVQUFBLENBQUMsSUFBSSxPQUFBLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQW5CLENBQW1CLENBQUMsQ0FBQztZQUV0RSxJQUFJLENBQUMsS0FBSyxHQUFRLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDO1lBRXpDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUM7WUFFdEUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLEVBQUU7Z0JBQzlDLEtBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNqQixDQUFDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqQixDQUFDO0lBQ0gs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QUFHLElBQUksRUFBRSxDQUFDLElBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDN0IsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUUvRCxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsR0FBRyxXQUFTLE1BQU0sTUFBRyxDQUFDO1lBQ3RELElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLDBCQUEwQixDQUFDLEdBQUcsTUFBTSxDQUFDO1lBQ3pELElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsT0FBTyxDQUFDO1FBQ3RELENBQUM7SUFDSCxDQUFDO0lBQ0gsaUJBQUM7QUFBRCxDQUFDLEFBeE5ELElBd05DO0FBQ0QsSUFBSSxVQUFVLENBQWMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO0FBQ25FLElBQUksVUFBVSxDQUFjLFFBQVEsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEF5Q2Fyb3VzZWwge1xuICBkcmFnZ2luZyA6IGJvb2xlYW47XG4gIG9mZnNldCA6IGFueTtcbiAgc3RhcnRYIDogbnVtYmVyID0gMDtcbiAgc3RhcnRZIDogbnVtYmVyID0gMDtcbiAgZGVsdGEgOiBhbnk7XG4gIHBvc2l0aW9uIDogYW55O1xuICBjdXJyZW50VHJhbnNsYXRlIDogbnVtYmVyO1xuICBsYXN0VHJhbnNsYXRlIDogbnVtYmVyO1xuICBjYWxsYmFja3MgOiBhbnkgPSB7fTtcbiAgY2FyZHMgOiBIVE1MRWxlbWVudFtdO1xuICBjYXJkV2lkdGggOiBudW1iZXI7XG4gIGluZGV4IDogbnVtYmVyID0gMDtcbiAgY2Fyb3VzZWwgOiBIVE1MRWxlbWVudDtcbiAgcmVhZG9ubHkgU05BUFBJTkVTUyA6IG51bWJlciA9IDQwO1xuICB0b3RhbE1vdmUgOiBhbnk7XG4gIGxhc3RQb3MgOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoY2Fyb3VzZWwgOiBIVE1MRWxlbWVudCkge1xuICAgIGlmKGNhcm91c2VsKSB7XG4gICAgICB0aGlzLmNhcm91c2VsID0gY2Fyb3VzZWw7XG4gICAgICBcbiAgICAgIHRoaXMuY2Fyb3VzZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGUgPT4gdGhpcy5vbmRyYWdzdGFydChlKSk7XG4gICAgICB0aGlzLmNhcm91c2VsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGUgPT4gdGhpcy5vbmRyYWdzdGFydChlKSk7XG5cbiAgICAgIHRoaXMuY2FyZHMgPSA8YW55PnRoaXMuY2Fyb3VzZWwuY2hpbGRyZW47XG5cbiAgICAgIHRoaXMuY2FyZFdpZHRoID0gdGhpcy5jYXJkc1swXS5vZmZzZXRXaWR0aCArIHRoaXMuY2FyZHNbMF0ub2Zmc2V0TGVmdDtcblxuICAgICAgdGhpcy5jYXJvdXNlbC5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgKCkgPT4ge1xuICAgICAgICB0aGlzLnJlc2NhbGUoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5yZXNjYWxlKCk7XG4gICAgfSBcbiAgfVxuXG4gIG9uZHJhZ3N0YXJ0KGUpIHtcbiAgICBjb25zdCB0b3VjaGVzID0gIGUudG91Y2hlcyA/IGUudG91Y2hlc1swXSA6IGU7XG4gICAgY29uc3Qge3BhZ2VYLCBwYWdlWX0gPSB0b3VjaGVzO1xuXG4gICAgY29uc3QgYm91bmRpbmdSZWN0ID0gdGhpcy5jYXJkc1t0aGlzLmluZGV4XS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB0aGlzLm9mZnNldCA9IHtcbiAgICAgIHg6IHBhZ2VYIC0gYm91bmRpbmdSZWN0LmxlZnQsXG4gICAgICB5OiBwYWdlWSAtIGJvdW5kaW5nUmVjdC50b3BcbiAgICB9O1xuXG4gICAgdGhpcy5kZWx0YSA9IHt9O1xuXG4gICAgdGhpcy5wb3NpdGlvbiA9IHtcbiAgICAgIHg6IHRoaXMuY2Fyb3VzZWwub2Zmc2V0TGVmdCxcbiAgICAgIHk6IHRoaXMuY2Fyb3VzZWwub2Zmc2V0VG9wXG4gICAgfTtcblxuICAgIGxldCBlZGdlVG9DYXJkRGlzdCA9IHRoaXMuY2FyZHNbdGhpcy5pbmRleF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcbiAgICB0aGlzLmxhc3RUcmFuc2xhdGUgPSB0aGlzLmNhcm91c2VsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLSBlZGdlVG9DYXJkRGlzdDtcblxuICAgIHRoaXMudG90YWxNb3ZlID0gXG4gICAgdGhpcy5zdGFydFggPSBwYWdlWDtcbiAgICB0aGlzLnN0YXJ0WSA9IHBhZ2VZO1xuXG4gICAgdGhpcy5kcmFnZ2luZyA9IHVuZGVmaW5lZDtcblxuICAgIHRoaXMuY2FsbGJhY2tzLm9ubW92ZSA9IGUgPT4gdGhpcy5vbmRyYWdtb3ZlKGUpO1xuICAgIHRoaXMuY2FsbGJhY2tzLm9uZW5kID0gZSA9PiB0aGlzLm9uZHJhZ2VuZChlKTtcblxuICAgIHRoaXMudG90YWxNb3ZlID0ge1xuICAgICAgeDogMCxcbiAgICAgIHk6IDBcbiAgICB9XG5cbiAgICB0aGlzLmxhc3RQb3MgPSB7XG4gICAgICB4OiAwLFxuICAgICAgeTogMFxuICAgIH1cbiAgICBcbiAgICB0aGlzLmNhcm91c2VsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuY2FsbGJhY2tzLm9ubW92ZSk7XG4gICAgdGhpcy5jYXJvdXNlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLmNhbGxiYWNrcy5vbm1vdmUpO1xuICAgIFxuICAgIHRoaXMuY2Fyb3VzZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCB0aGlzLmNhbGxiYWNrcy5vbmVuZCk7XG4gICAgdGhpcy5jYXJvdXNlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5jYWxsYmFja3Mub25lbmQpO1xuICAgIHRoaXMuY2Fyb3VzZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHRoaXMuY2FsbGJhY2tzLm9uZW5kKTtcbiAgfVxuXG4gIG9uZHJhZ21vdmUoZSkge1xuICAgIGNvbnN0IHRvdWNoZXMgPSAgZS50b3VjaGVzID8gZS50b3VjaGVzWzBdIDogZTtcbiAgICBjb25zdCB7cGFnZVgsIHBhZ2VZfSA9IHRvdWNoZXM7XG4gICAgY29uc3QgbW92ZSA9IHtcbiAgICAgIHg6IHRoaXMuc3RhcnRYIC0gcGFnZVgsXG4gICAgICB5OiB0aGlzLnN0YXJ0WSAtIHBhZ2VZXG4gICAgfVxuXG4gICAgLy8gS2VlcCB0cmFjayBvZiB0aGUgdG90YWwgZGlzdGFuY2UgbW92ZWQgcmlnaHQvbGVmdCBpbiB0aGUgbW92ZVxuICAgIHRoaXMudG90YWxNb3ZlLnggKz0gTWF0aC5hYnMobW92ZS54IC0gdGhpcy5sYXN0UG9zLngpO1xuICAgIHRoaXMudG90YWxNb3ZlLnkgKz0gTWF0aC5hYnMobW92ZS55IC0gdGhpcy5sYXN0UG9zLnkpO1xuICAgIFxuICAgIHRoaXMubGFzdFBvcyA9IHtcbiAgICAgIHg6IG1vdmUueCxcbiAgICAgIHk6IG1vdmUueVxuICAgIH07XG5cbiAgICBpZih0aGlzLnRvdGFsTW92ZS54IDwgMTAgJiYgdGhpcy50b3RhbE1vdmUueSA8IDEwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYodGhpcy50b3RhbE1vdmUueCA+IHRoaXMudG90YWxNb3ZlLnkpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuZGVsdGEgPSB7XG4gICAgICAgIHg6IHBhZ2VYIC0gdGhpcy5wb3NpdGlvbi54LFxuICAgICAgICB5OiBwYWdlWSAtIHRoaXMucG9zaXRpb24ueVxuICAgICAgfTtcbiAgICAgIGNvbnN0IGN1cnJlbnRUcmFuc2xhdGUgPSB0aGlzLmRlbHRhLnggKyB0aGlzLmxhc3RUcmFuc2xhdGUgLSB0aGlzLm9mZnNldC54O1xuXG4gICAgICB0aGlzLnRyYW5zbGF0ZShjdXJyZW50VHJhbnNsYXRlLCAwLCBudWxsKTtcblxuICAgICAgbGV0IGNhcmRNaWRwb2ludCA9ICh0aGlzLmNhcmRzW3RoaXMuaW5kZXhdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgKyB0aGlzLmNhcmRzW3RoaXMuaW5kZXhdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnJpZ2h0KSAvIDI7XG4gICAgICBsZXQgdmlld3BvcnRXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuXG4gICAgICBpZihjYXJkTWlkcG9pbnQgPD0gMCArIHRoaXMuU05BUFBJTkVTUykge1xuICAgICAgICAvLyBJZiBjYXJkIG1pZHBvaW50IGlzIGNsb3NlIGVub3VnaCB0byBsZWZ0IGVkZ2UsIGRlY3JlbWVudCBpbmRleFxuICAgICAgICB0aGlzLmluZGV4ID0gTWF0aC5taW4odGhpcy5pbmRleCsxLCB0aGlzLmNhcmRzLmxlbmd0aC0xKTtcbiAgICAgIH0gZWxzZSBpZihjYXJkTWlkcG9pbnQgPiB2aWV3cG9ydFdpZHRoIC0gdGhpcy5TTkFQUElORVNTKSB7XG4gICAgICAgIC8vIElmIGNhcmQgbWlkcG9pbnQgaXMgY2xvc2UgZW5vdWdoIHRvIHJpZ2h0IGVkZ2UsIGluY3JlbWVudCBpbmRleFxuICAgICAgICB0aGlzLmluZGV4ID0gTWF0aC5tYXgodGhpcy5pbmRleC0xLCAwKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzbmFwKG5leHRJbmRleD8gOiBudW1iZXIsIGRpcmVjdGlvbj8gOiBzdHJpbmcpIHtcbiAgICBpZihkaXJlY3Rpb24pIHtcbiAgICAgIGRpcmVjdGlvbiA9PSAncmlnaHQnID8gbmV4dEluZGV4ID0gdGhpcy5pbmRleCsxIDogbmV4dEluZGV4ID0gdGhpcy5pbmRleC0xO1xuICAgIH1cbiAgICBuZXh0SW5kZXggPSBNYXRoLm1pbihNYXRoLm1heChuZXh0SW5kZXgsIDApLCB0aGlzLmNhcmRzLmxlbmd0aCAtIDEpO1xuICAgIHRoaXMuaW5kZXggPSBuZXh0SW5kZXg7XG5cbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmNhcm91c2VsLnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgY29udGFpbmVyV2lkdGggPSBjb250YWluZXIub2Zmc2V0V2lkdGg7XG4gICAgY29uc3QgY29udGFpbmVyTWFyZ2luID0gcGFyc2VJbnQod2luZG93LmdldENvbXB1dGVkU3R5bGUoY29udGFpbmVyKS5tYXJnaW5MZWZ0LCAwKTtcbiAgXG4gICAgY29uc3QgY2FyZCA9IHRoaXMuY2FyZHNbbmV4dEluZGV4XTtcblxuICAgIC8vIFdpZHRoIG9mIGNvbnRhaW5lciAtIFdpZHRoIG9mIGNhcmQgPSBBbGwgdGhlIGV4dHJhIHNwYWNlXG4gICAgLy8gRGl2aWRlIHRoaXMgYnkgMiB0byBnZXQgZGVzaXJlZCBkaXN0YW5jZSBmcm9tIGVkZ2Ugb24gZWl0aGVyIHNpZGUgb2YgY2FyZFxuICAgIGNvbnN0IGVkZ2VUb0NhcmREaXN0ID0gKGNvbnRhaW5lcldpZHRoIC0gY2FyZC5vZmZzZXRXaWR0aCkvMjtcbiAgICBcbiAgICAvLyBUcmFuc2xhdGluZyB0byB0aGUgbGVmdCBvZiB0aGUgZGVzaXJlZCBjYXJkLCBtaW51cyBvdXIgZGVzaXJlZCBlZGdlIGRpc3RcbiAgICAvLyBNdWx0aXBsaWVkIGJ5IC0xIGJlY2F1c2Ugd2UgYXJlIHRyYW5zbGF0aW5nIHRvIHRoZSByaWdodFxuICAgIGNvbnN0IG5leHRPZmZzZXQgPSBNYXRoLm1pbigoY2FyZC5vZmZzZXRMZWZ0IC0gZWRnZVRvQ2FyZERpc3QgKyBjb250YWluZXJNYXJnaW4pICogLTEsIDApO1xuXG4gICAgLy8gaHR0cDovL2Vhc2luZ3MubmV0LyNlYXNlSW5PdXRDaXJjXG4gICAgY29uc3QgZWFzZSA9ICdjdWJpYy1iZXppZXIoMC43ODUsIDAuMTM1LCAwLjE1LCAwLjg2KSc7XG4gICAgdGhpcy50cmFuc2xhdGUobmV4dE9mZnNldCwgMjUwLCBlYXNlKTtcbiAgfVxuXG4gIG9uZHJhZ2VuZChlKSB7XG4gICAgdGhpcy5wb3NpdGlvbiA9IHtcbiAgICAgIHg6IGUudGFyZ2V0Lm9mZnNldExlZnQsXG4gICAgICB5OiBlLnRhcmdldC5vZmZzZXRUb3BcbiAgICB9O1xuXG4gICAgdGhpcy50b3RhbE1vdmUgPSB7XG4gICAgICB4OiAwLFxuICAgICAgeTogMFxuICAgIH07XG4gICAgdGhpcy5jYXJvdXNlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLmNhbGxiYWNrcy5vbm1vdmUpO1xuICAgIHRoaXMuY2Fyb3VzZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5jYWxsYmFja3Mub25tb3ZlKTtcbiAgICBcbiAgICB0aGlzLmNhcm91c2VsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJyx0aGlzLmNhbGxiYWNrcy5vbmVuZCk7XG4gICAgdGhpcy5jYXJvdXNlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5jYWxsYmFja3Mub25lbmQpO1xuICAgIHRoaXMuY2Fyb3VzZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHRoaXMuY2FsbGJhY2tzLm9uZW5kKTtcblxuICAgIHRoaXMuZHJhZ2dpbmcgPSB1bmRlZmluZWQ7XG5cbiAgICAvLyBTbmFwIHRvIGluZGV4LCB3aGljaCBoYXMgYmVlbiBzZXQgdG8gdGhlIG5lYXJlc3QgY2FyZFxuICAgIHRoaXMuc25hcCh0aGlzLmluZGV4LCB1bmRlZmluZWQpO1xuXG4gICAgdGhpcy5yZXNjYWxlKCk7XG4gIH1cblxuICB0cmFuc2xhdGUoeCA6IG51bWJlciwgbGVuZ3RoIDogbnVtYmVyLCBmbiA6IHN0cmluZykge1xuICAgIHRoaXMuY2Fyb3VzZWwuc3R5bGVbJ3RyYW5zaXRpb24nXSA9ICd0cmFuc2Zvcm0nO1xuICAgIHRoaXMuY2Fyb3VzZWwuc3R5bGVbJ3RyYW5zaXRpb25UaW1pbmdGdW5jdGlvbiddID0gZm47XG4gICAgdGhpcy5jYXJvdXNlbC5zdHlsZVsndHJhbnNpdGlvbkR1cmF0aW9uJ10gPSBgJHtsZW5ndGh9bXNgO1xuICAgIHRoaXMuY2Fyb3VzZWwuc3R5bGVbJ3RyYW5zZm9ybSddID0gYHRyYW5zbGF0ZTNkKCR7eH1weCwwcHgsMHB4KWA7XG5cbiAgICB0aGlzLnJlc2NhbGUoKTtcbiAgfVxuXG4gIHBlcmNlbnRWaXNpYmxlKGNhcmQgOiBIVE1MRWxlbWVudCkge1xuICAgIGxldCBjYXJkUmVjdCA9IGNhcmQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgbGV0IGNhcmRXaWR0aCA9IGNhcmQub2Zmc2V0V2lkdGg7XG4gICAgbGV0IGZyYW1lV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcblxuICAgIGlmKChjYXJkUmVjdC5sZWZ0IDwgMCAmJiBjYXJkUmVjdC5yaWdodCA8IDApIHx8IGNhcmRSZWN0LmxlZnQgPiBmcmFtZVdpZHRoKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9IGVsc2UgaWYoY2FyZFJlY3QubGVmdCA8IDApIHtcbiAgICAgIHJldHVybiBjYXJkUmVjdC5yaWdodC9jYXJkV2lkdGg7XG4gICAgfSBlbHNlIGlmKGNhcmRSZWN0LnJpZ2h0ID4gZnJhbWVXaWR0aCkge1xuICAgICAgcmV0dXJuIChmcmFtZVdpZHRoIC0gY2FyZFJlY3QubGVmdCkvY2FyZFdpZHRoO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gMTtcbiAgICB9XG4gIH1cblxuICByZXNjYWxlKCkge1xuICAgIC8vIFJlc2NhbGUgY3VycmVudCBjYXJkIGFuZCAyIGNhcmRzIGluIGVpdGhlciBkaXJlY3Rpb25cbiAgICBjb25zdCBmcm9tID0gTWF0aC5tYXgodGhpcy5pbmRleC0yICwwKTtcbiAgICBjb25zdCB0byA9IE1hdGgubWluKHRoaXMuaW5kZXgrMiwgdGhpcy5jYXJkcy5sZW5ndGgtMSlcblxuICAgIGZvcihsZXQgaSA9IGZyb207IGk8PXRvOyBpKyspIHtcbiAgICAgIGxldCBzY2FsZXIgPSBNYXRoLm1heCh0aGlzLnBlcmNlbnRWaXNpYmxlKHRoaXMuY2FyZHNbaV0pLCAwLjkpO1xuXG4gICAgICB0aGlzLmNhcmRzW2ldLnN0eWxlWyd0cmFuc2Zvcm0nXSA9IGBzY2FsZSgke3NjYWxlcn0pYDtcbiAgICAgIHRoaXMuY2FyZHNbaV0uc3R5bGVbJ3RyYW5zaXRpb25UaW1pbmdGdW5jdGlvbiddID0gJ2Vhc2UnO1xuICAgICAgdGhpcy5jYXJkc1tpXS5zdHlsZVsndHJhbnNpdGlvbkR1cmF0aW9uJ10gPSBgMjUwbXNgO1xuICAgIH1cbiAgfVxufVxubmV3IEF5Q2Fyb3VzZWwoPEhUTUxFbGVtZW50PmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjYXJvdXNlbC0xJykpO1xubmV3IEF5Q2Fyb3VzZWwoPEhUTUxFbGVtZW50PmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjYXJvdXNlbC0yJykpO1xuIl19